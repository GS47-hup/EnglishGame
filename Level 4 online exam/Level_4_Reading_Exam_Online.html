<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level 4 Reading Exam - Online | SpokenEnglish Academy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #16a085 0%, #138d75 100%);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #16a085 0%, #138d75 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .registration {
            padding: 30px;
            background: #ecf0f1;
            display: block;
        }

        .registration.hide {
            display: none;
        }

        .registration h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .btn {
            background: #16a085;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #138d75;
            transform: scale(1.05);
        }

        .timer-bar {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            display: none;
        }

        .timer-bar.active {
            display: block;
        }

        .timer-bar.warning {
            background: #f39c12;
            animation: pulse 1s infinite;
        }

        .timer-bar.critical {
            background: #e74c3c;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .content {
            padding: 40px;
            display: none;
        }

        .content.active {
            display: block;
        }

        .section-header {
            background: linear-gradient(135deg, #16a085 0%, #138d75 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .part {
            background: #f8f9fa;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 10px;
            border-left: 5px solid #16a085;
        }

        .part-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ddd;
        }

        .part-header h3 {
            color: #2c3e50;
            font-size: 1.5em;
        }

        .points {
            background: #27ae60;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .question {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .question-number {
            background: #16a085;
            color: white;
            padding: 5px 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
            font-weight: bold;
        }

        .answer-input {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .answer-input:focus {
            outline: none;
            border-color: #16a085;
        }

        .reading-passage {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #27ae60;
        }

        .reading-passage h4 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .word-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #16a085;
        }

        .option {
            display: block;
            padding: 12px;
            margin: 8px 0;
            background: white;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            border-color: #16a085;
            background: #ecf0f1;
        }

        .option input[type="radio"] {
            margin-right: 10px;
        }

        .submit-section {
            text-align: center;
            padding: 40px;
            background: #ecf0f1;
            border-radius: 10px;
            margin-top: 30px;
        }

        .submit-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 20px 60px;
            font-size: 1.5em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .submit-btn:hover {
            background: #229954;
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.3);
        }

        .summary {
            display: none;
            padding: 40px;
        }

        .summary.active {
            display: block;
        }

        .summary-header {
            background: #27ae60;
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .summary-section {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
        }

        .summary-question {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #16a085;
        }

        .answer-display {
            background: #d4edda;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            color: #155724;
        }

        .placeholder-note {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .placeholder-note strong {
            color: #856404;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            .content { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìñ Level 4 Reading Exam</h1>
            <p>Online Version - 25 Minutes | 25 Questions</p>
        </div>

        <!-- Registration -->
        <div id="registration" class="registration">
            <h2>üìã Student Information</h2>

            <div class="form-group">
                <label for="student-name">Student Name:</label>
                <input type="text" id="student-name" placeholder="Enter your full name" required autocomplete="off">
            </div>

            <div class="form-group">
                <label for="student-id">Student ID:</label>
                <input type="text" id="student-id" placeholder="Enter your student ID" required autocomplete="off">
            </div>

            <button class="btn" onclick="startExam()">Start Reading Exam</button>
        </div>

        <!-- Timer -->
        <div id="timer" class="timer-bar">
            <span id="timer-display">‚è±Ô∏è Time Remaining: 25:00</span>
        </div>

        <!-- Exam Content -->
        <div id="content" class="content">
            <div class="section-header">
                <h2>üìñ Reading Comprehension</h2>
                <p>Answer all 25 questions | Time: 25 minutes</p>
            </div>

            <!-- Part 1: Multiple Choice Pictures -->
            <div class="part">
                <div class="part-header">
                    <h3>Part 1: Multiple Choice Pictures</h3>
                    <span class="points">5 points</span>
                </div>
                <p><strong>Instructions:</strong> Read the texts and choose the correct answer (A, B, or C).</p>

                <div class="question">
                    <span class="question-number">1</span>

                    <div class="reading-passage" style="border-left-color: #3498db;">
                        <strong>Read the text:</strong><br>
                        "Emma loves climbing mountains every weekend. She goes climbing with her dad. She thinks climbing is very exciting!"
                    </div>

                    <strong>What does Emma like doing?</strong>

                    <label class="option">
                        <input type="radio" name="q1" value="A"> A) Climbing mountains
                    </label>
                    <label class="option">
                        <input type="radio" name="q1" value="B"> B) Hiking with backpack
                    </label>
                    <label class="option">
                        <input type="radio" name="q1" value="C"> C) Canoeing in a lake
                    </label>
                </div>

                <div class="question">
                    <span class="question-number">2</span>

                    <div class="reading-passage" style="border-left-color: #3498db;">
                        <strong>Read the text:</strong><br>
                        "At the zoo, Tom saw three animals. The panda is big. The cheetah is fast but not very big. The hippopotamus is the biggest animal of all three. Tom took a picture of the hippopotamus!"
                    </div>

                    <strong>Which animal is the biggest?</strong>

                    <label class="option">
                        <input type="radio" name="q2" value="A"> A) Panda
                    </label>
                    <label class="option">
                        <input type="radio" name="q2" value="B"> B) Hippopotamus
                    </label>
                    <label class="option">
                        <input type="radio" name="q2" value="C"> C) Cheetah
                    </label>
                </div>

                <div class="question">
                    <span class="question-number">3</span>

                    <div class="reading-passage" style="border-left-color: #3498db;">
                        <strong>Read the text:</strong><br>
                        "My sister Lily is very beautiful. She has shoulder-length, wavy hair. She wears a pink dress every day. All my friends think she looks lovely!"
                    </div>

                    <strong>What does Lily look like?</strong>

                    <label class="option">
                        <input type="radio" name="q3" value="A"> A) Shoulder-length wavy hair
                    </label>
                    <label class="option">
                        <input type="radio" name="q3" value="B"> B) Short curly hair
                    </label>
                    <label class="option">
                        <input type="radio" name="q3" value="C"> C) Short straight hair
                    </label>
                </div>

                <div class="question">
                    <span class="question-number">4</span>

                    <div class="reading-passage" style="border-left-color: #3498db;">
                        <strong>Read the text:</strong><br>
                        "Yesterday was Saturday. After school, Mike and his friends played baseball at the park. They played for two hours. Mike's team won the game! Everyone was very happy."
                    </div>

                    <strong>What did they play yesterday?</strong>

                    <label class="option">
                        <input type="radio" name="q4" value="A"> A) Baseball
                    </label>
                    <label class="option">
                        <input type="radio" name="q4" value="B"> B) Basketball
                    </label>
                    <label class="option">
                        <input type="radio" name="q4" value="C"> C) Volleyball
                    </label>
                </div>

                <div class="question">
                    <span class="question-number">5</span>

                    <div class="reading-passage" style="border-left-color: #3498db;">
                        <strong>Read the text:</strong><br>
                        "Next week, Lucy is going to go camping in the mountains. She is very excited! She's going to take her tent and sleeping bag. She wants to sleep under the stars every night!"
                    </div>

                    <strong>What is Lucy going to take on vacation?</strong>

                    <label class="option">
                        <input type="radio" name="q5" value="A"> A) Swimsuit and towel
                    </label>
                    <label class="option">
                        <input type="radio" name="q5" value="B"> B) Tent and sleeping bag
                    </label>
                    <label class="option">
                        <input type="radio" name="q5" value="C"> C) Flashlight and money
                    </label>
                </div>
            </div>

            <!-- Part 2: Matching Definitions -->
            <div class="part">
                <div class="part-header">
                    <h3>Part 2: Matching Definitions</h3>
                    <span class="points">5 points</span>
                </div>
                <p><strong>Instructions:</strong> Read the definitions and match them to the correct words from the box.</p>

                <div class="word-box">
                    <strong>Word Box:</strong> skateboard | whale | necklace | grill hamburgers | scientist | ferry
                </div>

                <div class="question">
                    <span class="question-number">6</span>
                    <strong>This is the longest sea creature.</strong>
                    <input type="text" class="answer-input" id="q6" placeholder="Type your answer here" autocomplete="off">
                </div>

                <div class="question">
                    <span class="question-number">7</span>
                    <strong>You wear this around your neck.</strong>
                    <input type="text" class="answer-input" id="q7" placeholder="Type your answer here" autocomplete="off">
                </div>

                <div class="question">
                    <span class="question-number">8</span>
                    <strong>This person wants to discover new things and do experiments.</strong>
                    <input type="text" class="answer-input" id="q8" placeholder="Type your answer here" autocomplete="off">
                </div>

                <div class="question">
                    <span class="question-number">9</span>
                    <strong>You can ride this on the street. It has four wheels.</strong>
                    <input type="text" class="answer-input" id="q9" placeholder="Type your answer here" autocomplete="off">
                </div>

                <div class="question">
                    <span class="question-number">10</span>
                    <strong>This is a boat that takes people across water.</strong>
                    <input type="text" class="answer-input" id="q10" placeholder="Type your answer here" autocomplete="off">
                </div>
            </div>

            <!-- Part 3: True or False Reading -->
            <div class="part">
                <div class="part-header">
                    <h3>Part 3: True or False Reading</h3>
                    <span class="points">5 points</span>
                </div>
                <p><strong>Instructions:</strong> Read the story and write T (True) or F (False).</p>

                <div class="reading-passage">
                    <h4>A Fun Weekend</h4>
                    <p>Last Saturday, Emma and her family went to the beach. Emma's favorite activity is swimming in the ocean, but yesterday the water was very cold. Her brother Tom took pictures with his camera. He wants to be a photographer when he grows up. Emma's dad grilled hamburgers for lunch. They were delicious! In the afternoon, they saw a parade. There were dancers and musicians. Emma bought a necklace from a shop near the beach. On Sunday, they stayed home and Emma painted pictures. She likes to paint pictures in her free time. It was a wonderful weekend!</p>
                </div>

                <div class="question">
                    <span class="question-number">11</span>
                    <strong>Emma went to the beach last Sunday.</strong>
                    <input type="text" class="answer-input" id="q11" placeholder="Type T or F" autocomplete="off">
                </div>

                <div class="question">
                    <span class="question-number">12</span>
                    <strong>Tom wants to be a photographer.</strong>
                    <input type="text" class="answer-input" id="q12" placeholder="Type T or F" autocomplete="off">
                </div>

                <div class="question">
                    <span class="question-number">13</span>
                    <strong>Emma's dad made cookies for lunch.</strong>
                    <input type="text" class="answer-input" id="q13" placeholder="Type T or F" autocomplete="off">
                </div>

                <div class="question">
                    <span class="question-number">14</span>
                    <strong>They saw a parade with dancers and musicians.</strong>
                    <input type="text" class="answer-input" id="q14" placeholder="Type T or F" autocomplete="off">
                </div>

                <div class="question">
                    <span class="question-number">15</span>
                    <strong>Emma painted pictures on Saturday.</strong>
                    <input type="text" class="answer-input" id="q15" placeholder="Type T or F" autocomplete="off">
                </div>
            </div>

            <!-- Part 4: Grammar Gap Fill -->
            <div class="part">
                <div class="part-header">
                    <h3>Part 4: Grammar Gap Fill</h3>
                    <span class="points">5 points</span>
                </div>
                <p><strong>Instructions:</strong> Complete the sentences with the correct word from the brackets.</p>

                <div class="question">
                    <span class="question-number">16</span>
                    <strong>The hippopotamus is ___________ than the panda. (big / bigger / biggest)</strong>
                    <input type="text" class="answer-input" id="q16" placeholder="Type your answer here" autocomplete="off">
                </div>

                <div class="question">
                    <span class="question-number">17</span>
                    <strong>What ___________ she eat for lunch yesterday? (do / did / does)</strong>
                    <input type="text" class="answer-input" id="q17" placeholder="Type your answer here" autocomplete="off">
                </div>

                <div class="question">
                    <span class="question-number">18</span>
                    <strong>She ___________ long, curly hair. (have / has / having)</strong>
                    <input type="text" class="answer-input" id="q18" placeholder="Type your answer here" autocomplete="off">
                </div>

                <div class="question">
                    <span class="question-number">19</span>
                    <strong>What are you ___________ to do on vacation? (go / going / went)</strong>
                    <input type="text" class="answer-input" id="q19" placeholder="Type your answer here" autocomplete="off">
                </div>

                <div class="question">
                    <span class="question-number">20</span>
                    <strong>The whale is the ___________ sea creature. (long / longer / longest)</strong>
                    <input type="text" class="answer-input" id="q20" placeholder="Type your answer here" autocomplete="off">
                </div>
            </div>

            <!-- Part 5: Reading Comprehension -->
            <div class="part">
                <div class="part-header">
                    <h3>Part 5: Reading Comprehension</h3>
                    <span class="points">5 points</span>
                </div>
                <p><strong>Instructions:</strong> Read the text and answer the questions.</p>

                <div class="reading-passage">
                    <h4>Sarah's Vacation Plans</h4>
                    <p>Sarah is very excited! Next week, she's going to go on vacation with her family to the beach. They're going to stay in a hotel near the ocean. Sarah is going to take her swimsuit, towel, and sunglasses. Her brother is going to take his camera because he wants to take pictures. On Monday, they're going to take a boat ride in the morning. In the afternoon, they're going to swim in the ocean. On Tuesday, they're going to see a show at the theater. Sarah's dad is good at swimming, so he's going to teach Sarah how to dive. Sarah also wants to make jewelry on the beach with shells. She thinks it's going to be the best vacation ever!</p>
                </div>

                <div class="question">
                    <span class="question-number">21</span>
                    <strong>When is Sarah going on vacation?</strong>
                    <label class="option">
                        <input type="radio" name="q21" value="A"> A) This week
                    </label>
                    <label class="option">
                        <input type="radio" name="q21" value="B"> B) Next week
                    </label>
                    <label class="option">
                        <input type="radio" name="q21" value="C"> C) Last week
                    </label>
                </div>

                <div class="question">
                    <span class="question-number">22</span>
                    <strong>Where are they going to stay?</strong>
                    <label class="option">
                        <input type="radio" name="q22" value="A"> A) In a tent
                    </label>
                    <label class="option">
                        <input type="radio" name="q22" value="B"> B) In a hotel
                    </label>
                    <label class="option">
                        <input type="radio" name="q22" value="C"> C) At a friend's house
                    </label>
                </div>

                <div class="question">
                    <span class="question-number">23</span>
                    <strong>What is Sarah's brother going to take?</strong>
                    <label class="option">
                        <input type="radio" name="q23" value="A"> A) A swimsuit
                    </label>
                    <label class="option">
                        <input type="radio" name="q23" value="B"> B) A camera
                    </label>
                    <label class="option">
                        <input type="radio" name="q23" value="C"> C) Sunglasses
                    </label>
                </div>

                <div class="question">
                    <span class="question-number">24</span>
                    <strong>Who is going to teach Sarah how to dive?</strong>
                    <label class="option">
                        <input type="radio" name="q24" value="A"> A) Her brother
                    </label>
                    <label class="option">
                        <input type="radio" name="q24" value="B"> B) Her dad
                    </label>
                    <label class="option">
                        <input type="radio" name="q24" value="C"> C) Her teacher
                    </label>
                </div>

                <div class="question">
                    <span class="question-number">25</span>
                    <strong>What does Sarah want to make on the beach?</strong>
                    <label class="option">
                        <input type="radio" name="q25" value="A"> A) Pictures
                    </label>
                    <label class="option">
                        <input type="radio" name="q25" value="B"> B) Jewelry
                    </label>
                    <label class="option">
                        <input type="radio" name="q25" value="C"> C) Movies
                    </label>
                </div>
            </div>

            <!-- SUBMIT SECTION -->
            <div class="submit-section">
                <h2>‚úÖ Finished? Submit Your Reading Exam</h2>
                <p style="margin: 20px 0; color: #666;">Please review your answers before submitting.</p>

                <button class="submit-btn" onclick="submitExam()">üìù SUBMIT READING EXAM</button>
            </div>
        </div>

        <!-- Summary Section -->
        <div id="summary" class="summary">
            <div class="summary-header">
                <h1>‚úÖ Reading Exam Submitted!</h1>
                <p style="margin-top: 10px;">Thank you for completing the Reading section</p>
                <p id="student-info" style="margin-top: 20px; font-size: 1.2em;"></p>
            </div>

            <div class="summary-section">
                <h3>üìñ Your Reading Answers (25 questions)</h3>
                <div id="answers-summary"></div>
            </div>

            <div style="text-align: center; margin-top: 30px; padding: 20px; background: #d4edda; border-radius: 10px;">
                <p style="color: #155724; font-size: 1.2em; font-weight: bold;">‚úÖ Your teacher will grade your exam and provide feedback soon.</p>
            </div>
        </div>
    </div>

    <script>
        let timerInterval;
        let timeRemaining = 25 * 60; // 25 minutes
        let examStartTime = null;
        let autoSaveInterval;
        const PROGRESS_KEY = 'level4_reading_progress';

        // Auto-fill student info from session and load saved progress
        window.addEventListener('DOMContentLoaded', function() {
            const examSession = sessionStorage.getItem('examSession');
            if (examSession) {
                const session = JSON.parse(examSession);
                document.getElementById('student-name').value = session.studentName || '';
                document.getElementById('student-id').value = 'AUTO-' + Date.now();
            }
        });

        // Load saved progress when exam starts
        function loadProgress() {
            const saved = localStorage.getItem(PROGRESS_KEY);
            if (saved) {
                try {
                    const progress = JSON.parse(saved);
                    // Restore text inputs
                    for (let i = 6; i <= 20; i++) {
                        const el = document.getElementById(`q${i}`);
                        if (el && progress[`q${i}`]) el.value = progress[`q${i}`];
                    }
                    // Restore radio buttons
                    for (let i = 1; i <= 5; i++) {
                        if (progress[`q${i}`]) {
                            const radio = document.querySelector(`input[name="q${i}"][value="${progress[`q${i}`]}"]`);
                            if (radio) radio.checked = true;
                        }
                    }
                    for (let i = 21; i <= 25; i++) {
                        if (progress[`q${i}`]) {
                            const radio = document.querySelector(`input[name="q${i}"][value="${progress[`q${i}`]}"]`);
                            if (radio) radio.checked = true;
                        }
                    }
                    console.log('‚úÖ Progress loaded successfully');
                } catch (e) {
                    console.error('Error loading progress:', e);
                }
            }
        }

        // Save progress automatically
        function saveProgress() {
            const progress = {};
            // Save text inputs
            for (let i = 6; i <= 20; i++) {
                const el = document.getElementById(`q${i}`);
                if (el && el.value) progress[`q${i}`] = el.value;
            }
            // Save radio buttons
            for (let i = 1; i <= 5; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                if (selected) progress[`q${i}`] = selected.value;
            }
            for (let i = 21; i <= 25; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                if (selected) progress[`q${i}`] = selected.value;
            }
            localStorage.setItem(PROGRESS_KEY, JSON.stringify(progress));
        }

        function startExam() {
            const name = document.getElementById('student-name').value;
            const id = document.getElementById('student-id').value;

            if (!name || !id) {
                alert('Please fill in all fields!');
                return;
            }

            localStorage.setItem('studentName', name);
            localStorage.setItem('studentId', id);
            examStartTime = new Date();

            document.getElementById('registration').classList.add('hide');
            document.getElementById('timer').classList.add('active');
            document.getElementById('content').classList.add('active');

            // Load any saved progress
            loadProgress();

            // Auto-save every 30 seconds
            autoSaveInterval = setInterval(saveProgress, 30000);

            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();

                if (timeRemaining === 5 * 60) {
                    document.getElementById('timer').classList.add('warning');
                    alert('‚ö†Ô∏è 5 minutes remaining!');
                }

                if (timeRemaining === 60) {
                    document.getElementById('timer').classList.remove('warning');
                    document.getElementById('timer').classList.add('critical');
                    alert('üö® Only 1 minute left!');
                }

                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    alert('‚è∞ Time is up!');
                    submitExam();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timer-display').textContent =
                `‚è±Ô∏è Time Remaining: ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        async function submitExam() {
            // Soft validation - warn but don't prevent submission
            const unanswered = [];

            // Check radio buttons q1-q5
            for (let i = 1; i <= 5; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                if (!selected) unanswered.push(i);
            }

            // Check text inputs q6-q20
            for (let i = 6; i <= 20; i++) {
                const el = document.getElementById(`q${i}`);
                if (!el || !el.value.trim()) unanswered.push(i);
            }

            // Check radio buttons q21-q25
            for (let i = 21; i <= 25; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                if (!selected) unanswered.push(i);
            }

            // Warn if there are unanswered questions
            if (unanswered.length > 0) {
                const proceed = confirm(`‚ö†Ô∏è Warning: You have ${unanswered.length} unanswered question(s): ${unanswered.join(', ')}\n\nDo you want to submit anyway?`);
                if (!proceed) return;
            }

            clearInterval(timerInterval);
            clearInterval(autoSaveInterval);

            const answers = {};

            // Radio buttons q1-q5, q21-q25
            for (let i = 1; i <= 5; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                answers[`q${i}`] = selected ? selected.value : '(No answer)';
            }

            // Text inputs q6-q20
            for (let i = 6; i <= 20; i++) {
                const el = document.getElementById(`q${i}`);
                answers[`q${i}`] = el ? el.value || '(No answer)' : '(No answer)';
            }

            // Radio buttons q21-q25
            for (let i = 21; i <= 25; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                answers[`q${i}`] = selected ? selected.value : '(No answer)';
            }

            // Calculate time taken
            const timeTaken = examStartTime ?
                Math.floor((new Date() - examStartTime) / 1000 / 60) + ' minutes' : 'N/A';

            // Submit to database
            await submitToDatabase(answers, timeTaken);

            // Clear saved progress after successful submission
            localStorage.removeItem(PROGRESS_KEY);

            displaySummary(answers);

            document.getElementById('timer').style.display = 'none';
            document.getElementById('content').style.display = 'none';
            document.getElementById('summary').classList.add('active');
        }

        async function submitToDatabase(answers, timeTaken) {
            const name = localStorage.getItem('studentName');
            const id = localStorage.getItem('studentId');

            const submissionData = {
                studentName: name,
                studentId: id,
                examType: 'Reading',
                level: 4,
                answers: answers,
                timeTaken: timeTaken,
                timestamp: new Date().toISOString()
            };

            try {
                const response = await fetch('/.netlify/functions/submit-level4-exam', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(submissionData)
                });

                const result = await response.json();

                if (result.success) {
                    console.log('‚úÖ Level 4 Reading Exam submitted to database successfully!', result);
                } else {
                    console.error('‚ùå Submission failed:', result.error);
                    alert('‚ö†Ô∏è Exam submitted but there was an issue saving to database. Please inform your teacher.');
                }
            } catch (error) {
                console.error('‚ùå Database submission error:', error);
                alert('‚ö†Ô∏è Exam submitted but there was a connection issue. Your answers are saved locally.');
            }
        }

        function displaySummary(answers) {
            const name = localStorage.getItem('studentName');
            const id = localStorage.getItem('studentId');
            const time = new Date().toLocaleString();

            document.getElementById('student-info').textContent =
                `Student: ${name} | ID: ${id} | Submitted: ${time}`;

            let html = '';
            for (let i = 1; i <= 25; i++) {
                html += `
                    <div class="summary-question">
                        <strong>Question ${i}:</strong>
                        <div class="answer-display">${answers[`q${i}`]}</div>
                    </div>
                `;
            }
            document.getElementById('answers-summary').innerHTML = html;

            console.log('Level 4 Reading Exam Submitted:', { student: {name, id}, answers, time });
        }
    </script>
</body>
</html>
